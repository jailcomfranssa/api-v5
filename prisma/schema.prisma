// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                     Int                   @id @default(autoincrement())
  email                  String                @unique
  senha                  String
  name                   String
  telefone               String?
  role                   Role                  @default(CLIENTE)

  // relacionamento inverso (1:1)
  clienteCadastro        ClienteCadastro?      @relation("UserToCliente")
  funcionarioCadastro    FuncionarioCadastro?  @relation("UserToFuncionario")

  createdAt              DateTime              @default(now())
  updatedAt              DateTime              @updatedAt
}

model ClienteCadastro {
  id               Int      @id @default(autoincrement())
  cpf              String   @unique @db.VarChar(11)
  rg               String?
  telefone         String?
  dataNascimento   DateTime?

  //usuario 1:1
  userId           Int      @unique
  user             User     @relation("UserToCliente", fields: [userId], references: [id], onDelete: Cascade)

  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  @@map("clientes")
}

model FuncionarioCadastro {
  id             Int      @id @default(autoincrement())
  cpf            String   @unique @db.VarChar(11)
  cargo          String
  telefone       String?
  salario        Decimal  @db.Decimal(10, 2)
  dataAdmissao   DateTime

  //usuario 1:1
  userId         Int      @unique
  user           User     @relation("UserToFuncionario", fields: [userId], references: [id], onDelete: Cascade)

  //compra N:1
  compras         Compra[]

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@map("funcionarios")
}

model Compra{
  id             Int      @id @default(autoincrement())
  data_compra    DateTime
  valor          Decimal  @db.Decimal(10, 2)

  //funcionario 1:N
  funcionario    FuncionarioCadastro @relation(fields: [funcionarioId], references: [id], onDelete: Restrict) //-> não excluir funcionário com compras registradas 
  funcionarioId  Int

  //fornecedor 1:N
  fornecedor Fornecedor @relation(fields: [fornecedorId], references: [id], onDelete: Restrict)
  fornecedorId Int

  @@index([fornecedorId])
  @@index([funcionarioId])

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@map("compras")

}

model Fornecedor{
  id             Int      @id @default(autoincrement())
  nome           String
  cnpj           String   @unique
  telefone       String
  email          String   @unique
  //compra N:1
  compras         Compra[]
  produto         Produto[]

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@map("fornecedores")

}

model Categoria{
  id             Int      @id @default(autoincrement())
  nome           String
  descricao      String
  status         Boolean  @default(true)

  produto         Produto[]

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

}

model Produto{
  id             Int      @id @default(autoincrement())
  nome           String
  descricao      String
  preco          Decimal  @db.Decimal(10, 2)
  data_validade  DateTime

  fornecedor Fornecedor @relation(fields: [fornecedorId], references: [id], onDelete: Restrict)
  fornecedorId Int

  categoria      Categoria @relation(fields: [categoriaId], references: [id], onDelete: Restrict) 
  categoriaId    Int

  medida         Medida

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt


  @@map("produto")
}

enum Role {
  ADMIN
  FUNCIONARIO
  CLIENTE
}

enum Medida {
  KG
  LITRO
  METRO
  UNIDADE
}


//npx tsc --noEmit
//npx prisma migrate dev --name <nome>
//npx prisma generate